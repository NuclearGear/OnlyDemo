<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>guzitest</title>
    <script src="https://cdn.bootcss.com/jquery/1.12.3/jquery.min.js"></script>
</head>
<body>
<H2>使用参数说明</H2>
<ul>
    <li>在浏览器打开，传入参数</li>
    <li>ip DP服务器地址</li>
    <li>sk DP对应的服务端口，非必填，默认80</li>
    <li>path 请求的路径</li>
</ul>
<script language="javascript">
var formatJson = function (json, options) {
	         var reg = null,
	                 formatted = '',
	                 pad = 0,
	                 PADDING = '    ';
	         options = options || {};
	         options.newlineAfterColonIfBeforeBraceOrBracket = (options.newlineAfterColonIfBeforeBraceOrBracket === true) ? true : false;
	         options.spaceAfterColon = (options.spaceAfterColon === false) ? false : true;
	         if (typeof json !== 'string') {
	             json = JSON.stringify(json);
	         } else {
	             json = JSON.parse(json);
	             json = JSON.stringify(json);
	         }
	         reg = /([\{\}])/g;
	         json = json.replace(reg, '\r\n$1\r\n');
	         reg = /([\[\]])/g;
	         json = json.replace(reg, '\r\n$1\r\n');
	         reg = /(\,)/g;
	         json = json.replace(reg, '$1\r\n');
	         reg = /(\r\n\r\n)/g;
	         json = json.replace(reg, '\r\n');
	         reg = /\r\n\,/g;
	         json = json.replace(reg, ',');
	         if (!options.newlineAfterColonIfBeforeBraceOrBracket) {
	             reg = /\:\r\n\{/g;
	             json = json.replace(reg, ':{');
	             reg = /\:\r\n\[/g;
	             json = json.replace(reg, ':[');
	         }
	         if (options.spaceAfterColon) {
	             reg = /\:/g;
	             json = json.replace(reg, ':');
	         }
	         (json.split('\r\n')).forEach(function (node, index) {
	                     var i = 0,
	                             indent = 0,
	                             padding = '';
	 
	                     if (node.match(/\{$/) || node.match(/\[$/)) {
	                         indent = 1;
	                     } else if (node.match(/\}/) || node.match(/\]/)) {
	                         if (pad !== 0) {
	                             pad -= 1;
	                         }
	                     } else {
	                         indent = 0;
	                     }
	 
	                     for (i = 0; i < pad; i++) {
	                         padding += PADDING;
	                     }
	 
	                     formatted += padding + node + '\r\n';
	                     pad += indent;
	                 }
	         );
	         return formatted;
	     };
	     
function doChage(obj) {
    
    var items = ["mediamax","adx","tanx","tencent","baidu","sina","gdt","baichuan","max","inmobi","yex","toutiao","aiqiyi",];
    var tVal = obj.options[obj.selectedIndex].value;
    console.log(tVal);
    var exchangeId = obj.options[obj.selectedIndex].getAttribute('exchangeid');
    var dbname = document.getElementById('dbname').value;
    var guziUrl = "/b?exid=" + exchangeId + "&pdt=" + exchangeId+ "&d=" + dbname + "&c=1";
    var request = document.getElementsByName("request")[0].value;
    console.log(request);
    document.getElementById('path').value = exchangeId == 99 ? "/b?_exid=2" : guziUrl;
    switch(tVal)
    {
    case "mediamax":
    	//(1)创建json格式或者从后台拿到对应的json格式
    	var originalJson = {"id":"HWN7a3sVm27cSSj50G6","tmax":100,"site":{"id":"1843","domain":"http://www.pptv.com","page":"https://images.sohu.com/bill/s2018/materials/sn/0316/1531.html","publisher":{"id":"3733"},"allyessitetype":"M01N02v2012.1","allyespageform":"R10101v2012.1"},"device":{"dnt":0,"ua":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36","os":"ios","ip":"114.92.105.81","language":"zh","js":1,"devicetype":2,"connectiontype":0,"h":100,"w":640,"pxratio":1},"user":{"id":"r%23gA0fUW0etbExgA0wUo0NfY","cver":2},"imp":[{"id":"1","https_flag":0,"banner":{"w":640,"h":100,"pos":0,"allyesadformat":[0,1,2],"allyesadform":"100"},"tagid":"3733-640100","bidfloor":0.01,"bidfloorcur":"CNY","audittype":true,"cbidfloor":0.01}],"cur":["CNY"],"app":{"id":"101","cat":["29999"],"bundle":"com.suning.yigou","publisher":{"id":"123"}}};
    	//(2)调用formatJson函数,将json格式进行格式化
    	var resultJson = formatJson(originalJson);
    	//(3)将格式化好后的json写入页面中
    	//document.getElementsByName("request")[0].value = resultJson;
    	//$("#request").val( '<pre>' +resultJson + '<pre/>')
    	//document.getElementsByName("request")[0].innerHTML = '<pre>' +resultJson + '<pre/>';
		request="{\"id\":\"HWN7a3sVm27cSSj50G6\",\"tmax\":100,\"site\":{\"id\":\"1843\",\"domain\":\"http://www.pptv.com\",\"page\":\"https://images.sohu.com/bill/s2018/materials/sn/0316/1531.html\",\"publisher\":{\"id\":\"3733\"},\"allyessitetype\":\"M01N02v2012.1\",\"allyespageform\":\"R10101v2012.1\"},\"device\":{\"dnt\":0,\"ua\":\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.84 Safari/537.36\",\"os\":\"ios\",\"ip\":\"114.92.105.81\",\"language\":\"zh\",\"js\":1,\"devicetype\":2,\"connectiontype\":0,\"h\":100,\"w\":640,\"pxratio\":1},\"user\":{\"id\":\"r%23gA0fUW0etbExgA0wUo0NfY\",\"cver\":2},\"imp\":[{\"id\":\"1\",\"https_flag\":0,\"banner\":{\"w\":640,\"h\":100,\"pos\":0,\"allyesadformat\":[0,1,2],\"allyesadform\":\"100\"},\"tagid\":\"3733-640100\",\"bidfloor\":0.01,\"bidfloorcur\":\"CNY\",\"audittype\":true,\"cbidfloor\":0.01}],\"cur\":[\"CNY\"],\"app\":{\"id\":\"101\",\"cat\":[\"29999\"],\"bundle\":\"com.suning.yigou\",\"publisher\":{\"id\":\"123\"}}}"
		document.getElementsByName("request")[0].value = resultJson;
        break;
    case "adx":
		request="test"
		document.getElementsByName("request")[0].value = request;
        break;
    case "tanx":

        break;
    case "baidu":
    	var originalJson = {"id":"13678964307524781123670336","ip":"192.168.1.101","user_agent":"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.13 (KHTML, like Gecko) Chrome/9.0.597.107 Safari/534.13,gzip","baidu_id_list":[{"baidu_user_id":"baiducookieid","baidu_user_id_version":1}],"user_category":[12,13],"gender":1,"flash_version":"1.3.0","detected_language":"zh-ch","url":"http://www.sina.com/","referer":"http://www.baidu.com/","site_category":32,"site_quality":21,"page_type":123,"page_keyword":["sina","testPage"],"page_quality":10,"page_vertical":98,"excluded_product_category":[1,2,3,4],"mobile":{"id":[{"type":0,"id":"unknowuserid"}],"device_type":1,"platform":1,"os_version":{"os_version_major":1,"os_version_minor":0,"os_version_micro":1},"brand":"brand","model":"model","screen_width":480,"screen_height":70,"carrier_id":46000,"wireless_network_type":2,"for_advertising_id":[{"type":4,"id":"ANDROID_ID"}],"mobile_app":{"app_id":"sogou","app_bundle_id":"sogou pingyin","app_category":12,"app_publisher_id":123,"app_interaction_type":[0,1]}},"video":{"title":"videotitle","tags":["a","b","c"],"content_length":145,"channel_id":[1,2,4]},"adslot":[{"ad_block_key":21003,"sequence_id":1,"adslot_type":6,"width":320,"height":50,"slot_visibility":3,"creative_type":[1,4],"excluded_landing_page_url":["http://www.taobao.com","http://www.jd.com"],"publisher_settings_list_id":[123,13231,1231],"minimum_cpm":20130,"video_info":{"max_video_duration":30,"min_video_duration":10,"video_start_delay":0},"link_unit_info":{"style_type":[1,2],"req_keyword_num":2,"proposed_keyword":["手机","苹果"]},"preferred_order_info":{"preferred_orders":[{"order_id":"order_a","fixed_cpm":1200000}],"allow_auction":false},"secure":true}],"is_test":false,"is_ping":false};
    	var resultJson = formatJson(originalJson);
    	document.getElementsByName("request")[0].value = resultJson;
        break;    
    case "max":

        break;       
    case "inmobi":
    
        break;     
    case "yex":
    	var originalJson ={"id":"2693dff1-fb33-4c42-b403-597258d0dcd3","imp":[{"id":"1","tagid":"fcf685be1d378879098a428ee5aa4ace","bidfloor":1100.0,"bidfloorcur":"CNY","secure":true,"native":{"request_native":{"ver":"1","plcmtcnt":3,"assets":[{"id":1,"required":true,"img":{"w":200,"h":200},"com.google.openrtb.youdao.sasset":{"id":1,"required":true,"img":{"w":54,"h":54}}},{"id":2,"required":true,"title":{"len":20},"com.google.openrtb.youdao.sasset":{"id":2,"required":true,"title":{"len":10}}}]}},"com.google.openrtb.youdao.ssid":11}],"app":{"id":"2500","name":"-iOS","bundle":"897003024","publisher":{"id":"728"},"com.google.openrtb.youdao.ydAppCategory":603},"device":{"dnt":false,"ua":"Mozilla/5.0 (iPhone; CPU iPhone OS 11_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E216 MailMaster/6.4.1.1188","ip":"139.222.182.224","geo":{},"didmd5":"46def0107a5a393f581cb5da4bb13cf3","make":"Apple","model":"iPhone","os":"IOS","osv":"11.3","connectiontype":2,"ifa":"63B422F7-6071-44EE-B2D7-1AC688D3F82A","com.google.openrtb.youdao.sdkVersion":"2.2.0"},"at":2,"tmax":200,"test":false,"com.google.openrtb.youdao.tfc":true};
    	var resultJson = formatJson(originalJson);
    	document.getElementsByName("request")[0].value = resultJson;
        break;
    case "ifeng":

        break; 
    case "oppo":

        break; 
    case"aiqiyi":

    case "toutiao":

        break;
    case "huawei":

        break; 
    default:
        System.out.println("default");
        break;
    }
}

function skChage(obj) {
	var ip = document.getElementById("ip").value;
	var sk = document.getElementById("sk").value;
	var db = document.getElementById("dbname").value;
	var path = document.getElementById('path').value
	if (ip =="10.200.44.37"){
		sk ="8889";
		db ="IFC_develop_autobuild";
	}else if (ip=="115.238.73.103"){
		sk="8080";
		db ="ifc_ui";
	}
	document.getElementById('sk').value = sk;
	document.getElementById('dbname').value = db;
}
</script>

<div style="border:1px solid green;padding: 2px 10px;">
    <form action='/send' method='POST' target="targetframe">
	<!--<div> IP
            <input name='ip' value="10.200.44.37">
        </div> -->
		<div> IP
            <select name="ip_name"  id="ip"  onchange="skChage(this)">
                <option  name='qa' value="10.200.44.37">10.200.44.37</option>
                <option  name='prod' value="115.238.73.103">115.238.73.103</option>
                <option  name='wm' value="10.28.5.190">10.28.5.190</option>
                <option  name='test' value="127.0.0.1">127.0.0.1</option>
			</select>
        </div>
        <div> 端口
            <input type="text" id="sk" name='sk' value="8080">
        </div>
        <div> 数据库
            <input type="text" id='dbname' value="ifc">
        </div>
        <div> 路径
            <input type="text" id='path' name='path' value="/b?exid=1&pdt=1&d=IFC_develop_autobuild&c=1" style='width:90%'>
        </div>
        <div>
            <span>类型</span>
            <select name="exchage_name" id="tpselect" onchange="doChage(this)">
                <option value="mediamax" exchangeid="1">模拟[ mediamax ]请求</option>
                <option value="adx" exchangeid="2">模拟[ adx ]请求</option>
                <option value="tanx" exchangeid="3">模拟[ tanx ]请求</option>
                <!--<option value="tencent" exchangeid="4">模拟[ tencent ]请求</option>-->
                <option value="baidu" exchangeid="5">模拟[ baidu ]请求</option>
                <option value="sina" exchangeid="6">模拟[ sina ]请求</option>
                <!--<option value="gdt" exchangeid="7">模拟[ gdt ]请求</option>-->
                <!--<option value="baichuan" exchangeid="8">模拟[ baichuan ]请求</option>-->
                <option value="max" exchangeid="9">模拟[ max ]请求</option>
                <option value="inmobi" exchangeid="10">模拟[ inmobi ]请求</option>
                <option value="yex" exchangeid="11">模拟[ yex ]请求</option>
                <option value="ifeng" exchangeid="12">模拟[ ifeng ]请求</option>
                <option value="oppo" exchangeid="13">模拟[ oppo ]请求</option> 
                <option value="aiqiyi"exchangeid="14">模拟[ aiqiyi ]请求</option>
                <option value="toutiao" exchangeid="15">模拟[ toutiao ]请求</option>
                <option value="huawei" exchangeid="16">模拟[ huawei ]请求</option>              
            </select>
        </div>
        <div><hr>
 			 <div ><br>
                <textarea id="request"   name="request" style="width:80%;height:200px;" th:text="'请填写request'"></textarea>
            </div>    
        </div>
        <div>
            <input id="submit" name="submit" value="submit" type="button" >
        </div>
        
    </form>
</div>
<br/>
<div style="border:1px solid green;padding: 2px 10px;">
 <textarea id="responer" name="responer" style="width:80%;height:200px;" th:text="${test}"></textarea>
</div>
<script>
    $("#submit").click(function () {

        $.post("/send",
            {ip:$("#ip").val(),sk:$("#sk").val(),path:$("#path").val(),request:$("#request").val(),exchageName:$("#tpselect option:selected").val()},
            function(result){
                $("#responer").val(result);
            });
    });
</script>
<h3>调试发送程序请找 </h3>
</body>
</html>